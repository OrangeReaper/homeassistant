  # Weather prediction
  - platform: time_date
    display_options:
      - 'time'
      - 'date'
      - 'date_time'
      - 'date_time_iso'
      - 'time_date'
      - 'time_utc'
      - 'beat'

  - platform: yr
  - platform: template
    sensors:
      dark:
        friendly_name: "It's Dark"
        value_template: >-
          {% if (states.sensor.time.state > "09:00") and (states.sensor.time.state < "15:00") %}
            no
          {% else %}
            {% if states('sensor.porch_luminance') | int < 80 %}
              yes
            {% else %}
              {% if state_attr('sun.sun', 'elevation') < 0  %}
                yes
              {% else %}
                no
              {% endif %}
            {% endif %}
          {% endif %}
  - platform: template
    sensors:
      all_home:
        friendly_name: "All Home"
        value_template: >-
          {% if is_state('group.tracker_paula', 'home')  %}
            {% if is_state('group.tracker_andy', 'home')  %}
              yes
            {% else %}
              no
            {% endif %}
          {% else %}
            no
          {% endif %}

  - platform: template
    sensors:
      mancave_occupied:
        friendly_name: "ManCave Occupied"
        value_template: >-
          {% if is_state('device_tracker.tv_mancave', 'home')  %}
            {% if is_state('group.mc_mediaplayers', 'home')  %}
              yes
            {% else %}
              no
            {% endif %}
          {% else %}
            no
          {% endif %}
  - platform: template
    sensors:
      porch_pir_battery:
        friendly_name: "Porch PIR Battery"
        entity_id: zwave.porch_motion_sensor
        value_template: "{{ state_attr('zwave.porch_motion_sensor', 'battery_level')|int|default(75) }}"
        device_class: battery
        unit_of_measurement: '%'
  - platform: template
    sensors:
      hive_battery:
        friendly_name: "Hive Battery"
        value_template: '{{ states.climate.heating.attributes.battery_level | replace("%","") | int }}'
  - platform: template
    sensors:
      nextsunrise:
        friendly_name: 'Next Sunrise'
        value_template: >
          {{ as_timestamp(states.sun.sun.attributes.next_rising) | timestamp_custom(' %I:%M%p') | replace(" 0", "") }}
        icon_template: mdi:weather-sunset-up
      nextsunset:
        friendly_name: 'Next Sunset'
        value_template: >
          {{ as_timestamp(states.sun.sun.attributes.next_setting) | timestamp_custom(' %I:%M%p') | replace(" 0", "") }}
        icon_template: mdi:weather-sunset-down
      night_length_today:
        friendly_name: 'Night Length Today'
        value_template: >
          {{ (as_timestamp(state_attr('sun.sun','next_rising')) - as_timestamp(state_attr('sun.sun','next_setting')))| int  }}
      dark_offset:
        friendly_name: 'Dark Offset'
        value_template: >
          {{ ((states('sensor.night_length_today') | int - 26933 | int) * 0.058269399) | int  }}
      time_to_next_sunset:
        friendly_name: 'Time To Next Sunset'
        value_template: >
          {{ as_timestamp(state_attr('sun.sun','next_setting')) | int - as_timestamp(now()) | int  }}
      elevation:
        friendly_name: 'Sun Elevation'
        value_template: >
          {{ state_attr('sun.sun','elevation') }}
